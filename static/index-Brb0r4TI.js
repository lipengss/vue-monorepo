import{ag as N,i as T,d as w,r as x,c as S,f as u,z as g,u as p,I as z,o as O,ah as R,ai as j,aj as D,ak as P,a as h,A as U}from"./index-D9Dc_mid.js";var b=N();const k=T(b),c=[],F=k.CancelToken,d=k.create({timeout:1e3*10}),E=e=>{for(const t in c){const a=+t,s=c[t];s.url===e.url&&s.method===e.method&&JSON.stringify(s.params)===JSON.stringify(e.params)&&JSON.stringify(s.data)===JSON.stringify(e.data)&&(s.cancel("操作太频繁，请稍后再试"),c.length>1&&c.splice(a,1))}};d.interceptors.request.use(e=>(E(e),e.cancelToken=new F(t=>{c.push({url:e.url,method:e.method,params:e.params,data:e.data,cancel:t})}),e),e=>Promise.reject(e));d.interceptors.response.use(e=>{var t;return E(e.config),(t=e==null?void 0:e.data)==null||t.errorCode,e},e=>{const t=e.response;switch(t==null?void 0:t.status){}const a=e.config,[s,m]=[0,1e3];return a&&s?(a.__retryCount=a.__retryCount||0,a.__retryCount>=s?Promise.reject(t||{message:e.message}):(a.__retryCount++,new Promise(i=>{setTimeout(()=>{i()},m||1)}).then(()=>d(a)))):Promise.reject(t||{message:e.message})});function J(e){return d({url:"/upload_video",method:"post",baseURL:"/upload",data:e})}const L=h("div",{class:"el-upload__text"},[U("拖拽文件到这里或者"),h("em",null,"点击上传")],-1),A=h("div",{class:"el-upload__tip"},"文件大小需小于500kb",-1),B=64*1024,V=w({__name:"index",setup(e){const t=x([]);let a=0;const s=x(0);async function m(i){const{file:o}=i,{name:l,type:f,size:r}=o,_=new Date().getTime()+"_"+l;for(;a<r;){const n=o.slice(a,a+B),v=y({name:l,type:f,size:r,fileName:_,uploadSize:a,fielChunk:n});try{const C=await J(v)}catch(C){z.error(C.message);return}a+=n.size,s.value=a/r*100}}function y({name:i,type:o,size:l,fileName:f,uploadSize:r,fielChunk:_}){const n=new FormData;return n.append("name",i),n.append("type",o),n.append("size",l),n.append("filename",f),n.append("uploadSize",r),n.append("file",_),n}return(i,o)=>(O(),S("div",null,[u(p(D),{class:"upload-demo","file-list":t.value,"onUpdate:fileList":o[0]||(o[0]=l=>t.value=l),accept:"image/png,image/jpeg",drag:"",action:"#",limit:1,"list-type":"text","http-request":m,multiple:""},{tip:g(()=>[A]),default:g(()=>[u(p(R),{class:"el-icon--upload"},{default:g(()=>[u(p(j))]),_:1}),L]),_:1},8,["file-list"]),u(p(P),{percentage:s.value},null,8,["percentage"])]))}});export{V as default};
